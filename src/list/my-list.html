<link rel="import" href="../../bower_components/polymer/polymer.html"/>
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../item/my-item.html">
<dom-module id="my-list">
    <template>
        <style>
            .container {
                padding: 20px;
                margin: 15px;
            }

            /*obliga a contenedor al tomar la altura de su contenido*/
            .container:before,
            .container:after {
                content: "";
                display: block;
                clear: both;
            }
        </style>
        <div class="container">
            <template is="dom-if" if="[[!long]]">
                <template is="dom-repeat" items="{{contacts}}">
                    <my-item contact="[[item]]"></my-item>
                </template>
            </template>
            <template is="dom-if" if="[[long]]">
                <h2>No hay contactos registrados</h2>
            </template>
        </div>
    </template>
    <script>
        Polymer({
            is: 'my-list',
            properties: {
                title: {
                    type: String,
                    value: 'CONTACTS'
                },
                contacts: {
                    type: Array,
                    value: []
                },
                contactSaved: {
                    type: Object,
                    notify: true,
                    reflectToAttribute: true,
                    observer: '_saveContact'
                },
                contactEdited: {
                    type: Object,
                    notify: true,
                    reflectToAttribute: true,
                    observer: '_updateContact'
                },
                contactDelete: {
                    type: Object,
                    notify: true,
                    reflectToAttribute: true,
                    observer: '_deleteContact'
                },
                long: {
                    type: Boolean,
                    value: false,
                    notify: true
                }
            },

            attached: function () {
                const url = 'https://randomuser.me/api/?results=10';
                fetch(url)
                    .then(request => {
                        return request.json();
                    })
                    .then(data => {
                        data.results.forEach(result => {
                            this.push('contacts', result);
                        });
                    })
                    .catch(error => {
                        console.log('Bad request loaded.');
                    });
            },
            _saveContact: function(){
                const contactsClone = this.contacts.slice(0);
                const long = contactsClone.length;
                contactsClone.splice(long,0,this.contactSaved);
                this.contacts = contactsClone;
                this.notifyPath('contacts.*');
            },
            _updateContact: function(){
                const contactsClone = this.contacts.slice(0);
                let a = 0;
                for(let i of contactsClone){
                    if(i.login.username === this.contactEdited.login.username){
                        contactsClone.splice(a,1,this.contactEdited);
                    }
                    console.log('position: '+a+' object: '+i);
                    a++;
                }
                this.contacts = contactsClone;
                this.notifyPath('contacts.*');
            },
            _deleteContact: function(){
                const contactsClone = this.contacts.slice(0);
                const position = this.contacts.indexOf(this.contactDelete);
                contactsClone.splice(position,1);
                this.contacts = contactsClone;
                this.notifyPath('contacts.*');
                if(this.contacts.length <= 0){
                    this.long = true;
                }
            },
        });

    </script>
</dom-module>
